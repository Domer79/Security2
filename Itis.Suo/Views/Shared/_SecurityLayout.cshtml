@using System.Web.Optimization

@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Angular Material style sheet -->
    <script src="~/scripts/exports.js" type="text/javascript"></script>

    <title>Настройка безопасности</title>

</head>
<body ng-app="SecurityApp">
    <div>
        @RenderBody()
    </div>

    @Styles.Render("~/styles/angular-material")
    @Scripts.Render("~/scripts/angular-material-package")
    @Scripts.Render("~/scripts/angular-ui-router")
    @Scripts.Render("~/scripts/security")

    <script type="text/javascript">
        "use strict";
        var securityApp = angular.module("SecurityApp", ['ngMaterial', 'ui.router']);

        securityApp.config(function ($stateProvider, $mdIconProvider) {
            $mdIconProvider.iconSet('navigation', '/Content/images/material-icons/iconsets/navigation-icons.svg');

            var states = [
                {
                    name: 'adminpanel',
                    url: '/adminpanel',
                    views: {
                        "main": {
                            templateUrl: "/Templates/AdminPanel",
                            controller: exports.controllers.AdminPanelController,
                            resolve: {
                                tab1: "tab1",
                                tab2: "tab2",
                                tab3: "tab3"
                            }
                        }
                    }
                },
                {
                    name: 'users',
                    parent: 'adminpanel',
                    url: '/users',
                    views: {
                        "users": {
                            template: "<md-content class='md-padding' ng-init='stateInit()'><md-list><md-list-item ng-repeat='user in users' ng-click='null'>{{user.Login}}</md-list-item></md-list></md-content>",
                            controller: 'UsersController'
                        }
                    }
//                    controller: 'UsersController'
                },
                {
                    name: 'users.detail',
//                    parent: 'users',
                    url: '/detail',
                    views: {
                        "tab1@adminpanel": {
                            template: "<div ng-controller='UsersDetailController'><h1>Tab1 {{name}}</h1></div>"
                        },
                        "tab2@adminpanel": {
                            template: "<div><h1>Tab2</h1></div>"
                        },
                        "tab3@adminpanel": {
                            template: "<div><h1>Tab3</h1></div>"
                        }
                    }
                }
            ];

            states.forEach(function (state) {
                $stateProvider.state(state);
            });
        });

        //        securityApp.controller("AdminPanelController", exports.controllers.AdminPanelController);

        securityApp.controller('UsersController', ['$scope', '$http', '$state', function ($scope, $http, $state) {
            debugger;
            $scope.tab1 = 'Профиль';
            $scope.tab2 = 'Роли';
            $scope.tab3 = 'Группы';

            $scope.getUserList = function () {
                $http.get("/Security/GetUserList").then(function (data) {
                    $scope.users = data.data;
                }, function (err) {
                    throw new Error(err);
                });
            }

            $scope.stateInit = function () {
                $scope.getUserList();
            }
        }]);

        securityApp.controller('UsersDetailController', ['$scope', function ($scope) {
            $scope.name = 'Привет';
        }]);

        securityApp.run(function ($state) {
            $state.go('adminpanel');
        });

    </script>

    @RenderSection("angularscript", false)

</body>
</html>
